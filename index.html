<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Game First Person</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: monospace;
      font-size: 14px;
      background: rgba(0,0,0,0.5);
      padding: 5px 10px;
      border-radius: 6px;
    }
    #startBtn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 15px 30px;
      font-size: 20px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background: #00ffcc;
    }
  </style>
</head>
<body>
  <div id="hud">
    Klik "Start Game" â†’ gunakan Mouse untuk lihat sekitar, WASD / Panah untuk bergerak, Spasi = Play/Pause Video
  </div>
  <button id="startBtn">Start Game</button>

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>

  <script>
    let scene, camera, renderer, controls;
    let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
    let velocity = new THREE.Vector3();
    let direction = new THREE.Vector3();
    let canJump = false;
    let videoPlaying = true;

    init();
    animate();

    function init(){
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Lighting
      const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
      scene.add(light);

      // Ground
      const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(200, 200),
        new THREE.MeshPhongMaterial({ color: 0x222222 })
      );
      ground.rotation.x = -Math.PI/2;
      scene.add(ground);

      // Video Walls
      createVideoWall("video1.mp4", -15, -20);
      createVideoWall("video2.mp4", 15, -20);

      // Controls (Pointer Lock)
      controls = new THREE.PointerLockControls(camera, document.body);

      const startBtn = document.getElementById("startBtn");
      startBtn.addEventListener("click", () => {
        controls.lock();
      });

      controls.addEventListener("lock", () => {
        startBtn.style.display = "none";
      });

      controls.addEventListener("unlock", () => {
        startBtn.style.display = "block";
      });

      // Keyboard controls
      document.addEventListener("keydown", onKeyDown);
      document.addEventListener("keyup", onKeyUp);

      window.addEventListener("resize", onWindowResize);
    }

    function createVideoWall(src, x, z){
      const video = document.createElement("video");
      video.src = src;
      video.loop = true;
      video.muted = true;
      video.autoplay = true;
      video.playsInline = true;
      video.play();

      const texture = new THREE.VideoTexture(video);
      const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide });

      const screen = new THREE.Mesh(new THREE.PlaneGeometry(16, 9), material);
      screen.position.set(x, 4.5, z);
      scene.add(screen);
    }

    function onKeyDown(event){
      switch(event.code){
        case "ArrowUp":
        case "KeyW": moveForward = true; break;
        case "ArrowLeft":
        case "KeyA": moveLeft = true; break;
        case "ArrowDown":
        case "KeyS": moveBackward = true; break;
        case "ArrowRight":
        case "KeyD": moveRight = true; break;
        case "Space": 
          videoPlaying = !videoPlaying;
          document.querySelectorAll("video").forEach(v=>{
            if(videoPlaying) v.play(); else v.pause();
          });
          break;
      }
    }

    function onKeyUp(event){
      switch(event.code){
        case "ArrowUp":
        case "KeyW": moveForward = false; break;
        case "ArrowLeft":
        case "KeyA": moveLeft = false; break;
        case "ArrowDown":
        case "KeyS": moveBackward = false; break;
        case "ArrowRight":
        case "KeyD": moveRight = false; break;
      }
    }

    function onWindowResize(){
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate(){
      requestAnimationFrame(animate);

      if(controls.isLocked){
        const delta = 0.1;

        velocity.x -= velocity.x * 0.1;
        velocity.z -= velocity.z * 0.1;

        direction.z = Number(moveForward) - Number(moveBackward);
        direction.x = Number(moveRight) - Number(moveLeft);
        direction.normalize();

        if(moveForward || moveBackward) velocity.z -= direction.z * 0.2;
        if(moveLeft || moveRight) velocity.x -= direction.x * 0.2;

        controls.moveRight(-velocity.x * delta);
        controls.moveForward(-velocity.z * delta);
      }

      renderer.render(scene, camera);
    }
  </script>
</body>
</html>
